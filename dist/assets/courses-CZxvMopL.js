import{B as e,C as t,F as n,H as r,M as i,N as a,P as o,Tt as s,Xt as c,it as l,tt as u,wt as d,yt as f,z as p}from"./vue-UmFUivib.js";import{$ as ee,H as te,Nt as ne,Pt as m,Q as h,_t as g,bt as _,fn as v,ht as y,kt as b,nt as re,ot as x,pt as S,rn as ie,vt as C}from"./antd-B_p1HNUS.js";import{t as w}from"./crud-operations-CX0bmYPf.js";var ae=[`onClick`],oe=[`onClick`],se={style:{"margin-top":`16px`,"text-align":`right`}},ce=[`onClick`],T=r({__name:`index`,setup(r){let T=s([]),E=s([]),D=s(!1),O=s(!1),k=s(``),A=s(!1),j=s(null),M=d({}),le=s(),N=s(!1),P=s([]),F=s(!1),I=d({}),L=s(null),R=s(),z=d({current:1,total:0,pageSize:10}),B=[{title:`Course Code`,dataIndex:`course_code`},{title:`Course Name`,dataIndex:`course_name`},{title:`Department`,dataIndex:`department_name`},{title:`Duration (Years)`,dataIndex:`duration_years`},{title:`Actions`,dataIndex:`actions`}];function V(e){return[{required:!0,message:`Please input ${e}`}]}async function H(e=z.current){D.value=!0;try{let{data:t}=await w.list(`courses`,{search:k.value,page:e,per_page:z.pageSize});T.value=t.data,z.current=t.current_page,z.total=t.total}finally{D.value=!1}}function U(){z.current=1,H()}async function W(){O.value=!0;try{let{data:e}=await w.list(`departments`);E.value=e.data.map(e=>({label:`${e.department_code} - ${e.department_name}`,value:e.department_id}))}finally{O.value=!1}}function G(e=null){j.value=e,Object.keys(M).forEach(e=>delete M[e]),e&&Object.assign(M,e),A.value=!0}async function ue(){try{let e={...M};j.value?await w.update(`courses`,j.value.course_id,e):await w.create(`courses`,e),b.success(`Saved successfully!`),A.value=!1,await H()}catch{b.error(`Error saving record`)}}async function de(e){try{await w.remove(`courses`,e.course_id),b.success(`Deleted successfully!`),await H()}catch{b.error(`Error deleting record`)}}function fe(e){z.current=e,H(e)}async function K(e){L.value=e;let{data:t}=await w.get(`courses`,e.course_id);P.value=t.subjects||[],N.value=!0}function q(e=null){Object.keys(I).forEach(e=>delete I[e]),e&&Object.assign(I,e),F.value=!0}async function pe(){try{let e={...I};I.subject_id?await w.update(`subjects`,I.subject_id,e):await w.create(`courses/${L.value.course_id}/subjects`,e),b.success(`Subject saved!`),F.value=!1,K(L.value)}catch(e){let t=e?.response?.data?.errors,n=e?.response?.data?.message||`Error saving subject`;if(t){let e=Object.values(t).flat().join(`
`);b.error(`${n}:\n${e}`,6)}else b.error(n)}}async function me(e){await w.remove(`subjects`,e.subject_id),b.success(`Deleted successfully!`),K(L.value)}return u(()=>{H(),W()}),(r,s)=>{let u=C,d=ie,b=ee,w=h,H=te,W=x,J=y,Y=m,X=v,Z=S,he=g,Q=ne,$=re,ge=_;return l(),n(`div`,null,[e(b,{style:{"margin-bottom":`16px`,width:`100%`}},{default:f(()=>[e(u,{value:k.value,"onUpdate:value":s[0]||=e=>k.value=e,placeholder:`Search courses...`,"enter-button":``,style:{"max-width":`300px`},onSearch:U},null,8,[`value`]),e(d,{type:`primary`,onClick:s[1]||=e=>G()},{default:f(()=>[...s[16]||=[p(` Add Course `,-1)]]),_:1})]),_:1}),e(H,{columns:B,"data-source":T.value,loading:D.value,"row-key":`course_id`,bordered:``,pagination:!1},{bodyCell:f(({column:r,record:o})=>[r.dataIndex===`actions`?(l(),a(b,{key:0},{default:f(()=>[i(`a`,{onClick:e=>G(o)},`Edit`,8,ae),i(`a`,{onClick:e=>K(o)},`Subjects`,8,oe),e(w,{title:`Delete this course?`,"ok-text":`Yes`,"cancel-text":`No`,onConfirm:e=>de(o)},{default:f(()=>[...s[17]||=[i(`a`,null,`Delete`,-1)]]),_:1},8,[`onConfirm`])]),_:2},1024)):r.dataIndex===`department_name`?(l(),n(t,{key:1},[p(c(o.department?.department_name||`-`),1)],64)):(l(),n(t,{key:2},[p(c(o[r.dataIndex]),1)],64))]),_:1},8,[`data-source`,`loading`]),i(`div`,se,[e(W,{current:z.current,total:z.total,"page-size":z.pageSize,"show-total":e=>`Total ${e} courses`,onChange:fe},null,8,[`current`,`total`,`page-size`,`show-total`])]),e($,{open:A.value,"onUpdate:open":s[7]||=e=>A.value=e,title:j.value?`Edit Course`:`Add Course`,onOk:ue},{default:f(()=>[e(Q,{ref_key:`formRef`,ref:le,model:M,layout:`vertical`},{default:f(()=>[e(Y,{label:`Course Code`,name:`course_code`,rules:V(`Course Code`)},{default:f(()=>[e(J,{value:M.course_code,"onUpdate:value":s[2]||=e=>M.course_code=e},null,8,[`value`])]),_:1},8,[`rules`]),e(Y,{label:`Course Name`,name:`course_name`,rules:V(`Course Name`)},{default:f(()=>[e(J,{value:M.course_name,"onUpdate:value":s[3]||=e=>M.course_name=e},null,8,[`value`])]),_:1},8,[`rules`]),e(Y,{label:`Department`,name:`department_id`},{default:f(()=>[e(X,{value:M.department_id,"onUpdate:value":s[4]||=e=>M.department_id=e,options:E.value,loading:O.value},null,8,[`value`,`options`,`loading`])]),_:1}),e(Y,{label:`Duration (Years)`,name:`duration_years`},{default:f(()=>[e(Z,{value:M.duration_years,"onUpdate:value":s[5]||=e=>M.duration_years=e,min:1,max:6,style:{width:`100%`}},null,8,[`value`])]),_:1}),e(Y,{label:`Description`,name:`description`},{default:f(()=>[e(he,{value:M.description,"onUpdate:value":s[6]||=e=>M.description=e,rows:3},null,8,[`value`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`open`,`title`]),e(ge,{open:N.value,"onUpdate:open":s[15]||=e=>N.value=e,title:`Subjects for ${L.value?.course_name||``}`,width:`70%`},{default:f(()=>[e(d,{type:`primary`,style:{"margin-bottom":`12px`},onClick:s[8]||=e=>q()},{default:f(()=>[...s[18]||=[p(` Add Subject `,-1)]]),_:1}),e(H,{"data-source":P.value,"row-key":`subject_id`,bordered:``,columns:[{title:`Code`,dataIndex:`subject_code`},{title:`Name`,dataIndex:`subject_name`},{title:`Units`,dataIndex:`units`},{title:`Year`,dataIndex:`year_level`},{title:`Semester`,dataIndex:`semester`},{title:`Actions`,dataIndex:`actions`}]},{bodyCell:f(({column:t,record:n})=>[t.dataIndex===`actions`?(l(),a(b,{key:0},{default:f(()=>[i(`a`,{onClick:e=>q(n)},`Edit`,8,ce),e(w,{title:`Delete this subject?`,"ok-text":`Yes`,"cancel-text":`No`,onConfirm:e=>me(n)},{default:f(()=>[...s[19]||=[i(`a`,null,`Delete`,-1)]]),_:1},8,[`onConfirm`])]),_:2},1024)):o(``,!0)]),_:1},8,[`data-source`]),e($,{open:F.value,"onUpdate:open":s[14]||=e=>F.value=e,title:`Subject Details`,onOk:pe},{default:f(()=>[e(Q,{ref_key:`subjectFormRef`,ref:R,model:I,layout:`vertical`},{default:f(()=>[e(Y,{label:`Subject Code`,name:`subject_code`,rules:V(`Subject Code`)},{default:f(()=>[e(J,{value:I.subject_code,"onUpdate:value":s[9]||=e=>I.subject_code=e},null,8,[`value`])]),_:1},8,[`rules`]),e(Y,{label:`Subject Name`,name:`subject_name`,rules:V(`Subject Name`)},{default:f(()=>[e(J,{value:I.subject_name,"onUpdate:value":s[10]||=e=>I.subject_name=e},null,8,[`value`])]),_:1},8,[`rules`]),e(Y,{label:`Units`,name:`units`},{default:f(()=>[e(Z,{value:I.units,"onUpdate:value":s[11]||=e=>I.units=e,min:1,max:10,style:{width:`100%`}},null,8,[`value`])]),_:1}),e(Y,{label:`Year Level`,name:`year_level`},{default:f(()=>[e(X,{value:I.year_level,"onUpdate:value":s[12]||=e=>I.year_level=e,options:[{label:`1st Year`,value:1},{label:`2nd Year`,value:2},{label:`3rd Year`,value:3},{label:`4th Year`,value:4}]},null,8,[`value`])]),_:1}),e(Y,{label:`Semester`,name:`semester`},{default:f(()=>[e(X,{value:I.semester,"onUpdate:value":s[13]||=e=>I.semester=e,options:[{label:`1st`,value:`1st`},{label:`2nd`,value:`2nd`},{label:`Summer`,value:`Summer`}]},null,8,[`value`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`open`])]),_:1},8,[`open`,`title`])])}}});export{T as default};