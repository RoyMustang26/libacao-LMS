import{B as e,F as t,M as n,P as r,Tt as i,Xt as a,h as o,it as s,j as c,tt as l,yt as u,z as d}from"./vue-UmFUivib.js";import{H as f,Q as p,ht as m,kt as h,rn as g}from"./antd-B_p1HNUS.js";import{t as _}from"./axios-DfJNXXRN.js";import{n as v,t as y}from"./form-CsUUnFNd.js";var b={class:`p-6 bg-gray-900 min-h-screen text-white`},x={class:`flex justify-between items-center mb-4`},S={class:`text-2xl font-semibold`},C={class:`flex gap-2 mb-4`},w={key:0,class:`flex gap-2`},T={__name:`timeslot`,setup(T){o();let E=i([]),D=i([]),O=i([]),k=i([]),A=i([]),j=i([]),M=i({day:``,subject:``}),N=c(()=>sessionStorage.getItem(`day_of_week`)||`N/A`),P=c(()=>Number(sessionStorage.getItem(`start_hour`))||null),F=c(()=>P.value===null?null:P.value+1),I=c(()=>P.value===null||F.value===null?`(N/A)`:`(${P.value}:00 - ${F.value}:00)`),L=i(!1),R=i(!1),z=i(null),B=[{title:`Subject`,dataIndex:`subject_name`,key:`subject`},{title:`Professor`,dataIndex:`professor_name`,key:`professor_name`},{title:`Section`,dataIndex:`section_name`,key:`section_name`},{title:`Room`,dataIndex:`room_name`,key:`room`},{title:`Actions`,key:`actions`}],V=c(()=>E.value.filter(e=>e.day_of_week?.toLowerCase().includes(M.value.day.toLowerCase())&&e.subject_name?.toLowerCase().includes(M.value.subject.toLowerCase())));async function H(){try{let e=sessionStorage.getItem(`day_of_week`),t=sessionStorage.getItem(`start_hour`);E.value=(await v.fetchTimeslotSchedules(e,t)).map(e=>({...e,subject_name:e.subject?.subject_name||``,professor_name:e.professor?`${e.professor.first_name} ${e.professor.last_name}`:``,section_name:e.class_section?.section_name||``,room_name:e.room?`${e.room.building_name} - ${e.room.room_number}`:``}))}catch{h.error(`Failed to load schedules`)}}async function U(){try{let{data:e}=await _.get(`http://localhost:8000/api/subjects`);D.value=e}catch{h.error(`Failed to load subjects`)}}async function W(){try{let{data:e}=await _.get(`http://localhost:8000/api/professors`);O.value=e}catch{h.error(`Failed to load professors`)}}async function G(){try{let{data:e}=await _.get(`http://localhost:8000/api/rooms`);k.value=e}catch{h.error(`Failed to load rooms`)}}async function K(){try{let{data:e}=await _.get(`http://localhost:8000/api/sections`);j.value=e}catch{h.error(`Failed to load sections`)}}async function q(){try{let{data:e}=await _.get(`http://localhost:8000/api/courses`);A.value=e}catch{h.error(`Failed to load courses`)}}function J(){U(),W(),G(),K(),q(),z.value=null,R.value=!1,L.value=!0}function Y(e){U(),W(),G(),K(),q(),z.value={...e},R.value=!0,L.value=!0}async function X(){await H()}async function Z(e){try{await v.deleteSchedule(e),h.success(`Schedule deleted successfully`),H()}catch{h.error(`Failed to delete schedule`)}}return l(H),(i,o)=>{let c=g,l=m,h=p,_=f;return s(),t(`div`,b,[n(`div`,x,[n(`h1`,S,` Class Scheduler â€“ `+a(N.value)+` `+a(I.value),1),e(c,{type:`primary`,onClick:J},{default:u(()=>[...o[3]||=[d(` + Add Schedule `,-1)]]),_:1})]),n(`div`,C,[e(l,{value:M.value.day,"onUpdate:value":o[0]||=e=>M.value.day=e,placeholder:`Search by day`,"allow-clear":``,style:{width:`200px`}},null,8,[`value`]),e(l,{value:M.value.subject,"onUpdate:value":o[1]||=e=>M.value.subject=e,placeholder:`Search by subject`,"allow-clear":``,style:{width:`200px`}},null,8,[`value`]),e(c,{type:`default`,onClick:H},{default:u(()=>[...o[4]||=[d(` Search `,-1)]]),_:1})]),e(_,{columns:B,"data-source":V.value,"row-key":`class_schedule_id`,bordered:``,pagination:{pageSize:5}},{bodyCell:u(({column:n,record:i})=>[n.key===`actions`?(s(),t(`div`,w,[e(c,{type:`link`,onClick:e=>Y(i)},{default:u(()=>[...o[5]||=[d(` Edit `,-1)]]),_:1},8,[`onClick`]),e(h,{title:`Are you sure you want to delete this schedule?`,"ok-text":`Yes`,"cancel-text":`No`,onConfirm:e=>Z(i.class_schedule_id)},{default:u(()=>[e(c,{danger:``,type:`link`},{default:u(()=>[...o[6]||=[d(` Delete `,-1)]]),_:1})]),_:1},8,[`onConfirm`])])):r(``,!0)]),_:1},8,[`data-source`]),e(y,{open:L.value,"is-editing":R.value,record:z.value,subjects:D.value,professors:O.value,rooms:k.value,"courses:":A.value,sections:j.value,onClose:o[2]||=e=>L.value=!1,onSaved:X},null,8,[`open`,`is-editing`,`record`,`subjects`,`professors`,`rooms`,`courses:`,`sections`])])}}};export{T as default};