import{B as e,C as t,F as n,H as r,K as i,M as a,N as o,P as s,Tt as c,X as l,Xt as u,Yt as d,_t as f,it as p,j as m,st as h,tt as g,yt as _,z as v}from"./vue-UmFUivib.js";import{H as ee,It as te,Lt as ne,Nt as re,Pt as ie,U as ae,bt as oe,ht as se,kt as y,nt as ce,on as le,rn as ue,st as de}from"./antd-B_p1HNUS.js";import{l as b,p as x}from"./index-BwYHa19M.js";import"./search-modal-BFuDBt1f.js";import{t as fe}from"./calendar-controls-p5sh_USo.js";var pe={class:`flex justify-between items-center mb-6`},me={key:0,class:`flex justify-center items-center h-64`},he={key:1,class:`calendar-wrap`},ge={class:`calendar-header`},_e={class:`day-label`},ve={class:`calendar-body`},ye={class:`time-col sticky-time-col`},be={key:0,class:`time-text`},xe={class:`events-container`},Se=[`onClick`],Ce={class:`event-title`},we={class:`event-sections`},Te={key:0,class:`event-extra`},Ee=[`onClick`],De={class:`event-title`},Oe={class:`event-sections`},ke={key:0,class:`event-extra`},Ae=[`onClick`],je={class:`event-title`},Me={class:`event-sections`},Ne={key:0,class:`event-extra`},Pe=[`onClick`],Fe={class:`event-title`},Ie={key:0},Le={key:1},Re={key:2},ze={key:0},S=30,C=x(r({__name:`calendar`,setup(r){let x=[{key:`Monday`,label:`Mon`},{key:`Tuesday`,label:`Tue`},{key:`Wednesday`,label:`Wed`},{key:`Thursday`,label:`Thu`},{key:`Friday`,label:`Fri`},{key:`Saturday`,label:`Sat`}],C=c([]),w=c({}),T=c({}),E=c(!0),D=c({academic_year:`2025-2026`,semester:`1st`,course_id:1}),O=c(!1),k=c(``),A=c([]),j=c(`multi-timeslot`),M=c(!1),N=c(null),P=c([]),F=c(420),I=c(1080),L=c(null),R=c(null),z=c(600),B=m(()=>{let e=Math.max(60,I.value-F.value)/60,t=z.value?z.value/e:62;return Math.max(40,t)}),V=m(()=>B.value*(S/60));async function H(){E.value=!0;try{let e=new URLSearchParams({academic_year:D.value.academic_year,semester:D.value.semester,course_id:String(D.value.course_id)}).toString(),t=await b(`/schedules/query?${e}`);if(!t||!t.data)throw Error(`Failed to fetch schedules`);C.value=t.data}catch{y.warning(`Could not fetch schedules, using sample payload`),C.value=[]}U(),W(),E.value=!1}function U(){if(!C.value?.length)return;let e=1440,t=0;for(let n of C.value){let r=G(n.start_time),i=G(n.end_time);r<e&&(e=r),i>t&&(t=i)}F.value=Math.max(360,Math.floor(e/60)*60),I.value=Math.min(1320,Math.ceil(t/60)*60)}function W(){let e={};for(let t of C.value){let n=t.day_of_week;e[n]||(e[n]=[]),e[n].push({id:`${n}-${t.start_time}-${t.end_time}-${Math.random().toString(36).slice(2,6)}`,label:t.label||`${t.count} classes`,start:G(t.start_time),end:G(t.end_time),count:t.count,col:0,groupCols:1,classes:t.classes,raw:t})}let t={},n={};for(let r of x){let i=(e[r.key]||[]).slice();if(!i.length){t[r.key]=[],n[r.key]=[];continue}i.sort((e,t)=>e.start-t.start||e.end-t.end);let a=[],o={...i[0]};for(let e=1;e<i.length;e++){let t=i[e];t.start<o.end?(o.end=Math.max(o.end,t.end),o.count+=t.count,o.classes=[...o.classes||[],...t.classes||[]]):(a.push(o),o={...t})}a.push(o);let s=[],c=[];for(let e of a)s.push({...e,col:0,groupCols:1}),c.push([e]);t[r.key]=s,n[r.key]=c}w.value=t,T.value=n}let Be=m(()=>{let e=Array.isArray(A.value)?A.value:A.value?[A.value]:[],t={};for(let n of e)for(let e of n.classes){let n=`${e.start_time} – ${e.end_time}`;t[n]||(t[n]=[]),t[n].push(e)}let n=Object.entries(t);return n.sort((e,t)=>{let n=e[0].split(`–`)[0].trim(),r=t[0].split(`–`)[0].trim();return n.localeCompare(r)}),n.map(([e,t])=>({key:e,classes:t}))});function G(e){let[t,n=`0`]=e.split(`:`);return Number(t)*60+Number(n)}function K(e){let t=Math.floor(e/60),n=e%60;return`${String(t).padStart(2,`0`)}:${String(n).padStart(2,`0`)}`}function Ve(e){let t=Math.floor(e/60),n=t>=12?`PM`:`AM`;return`${(t+11)%12+1}:00 ${n}`}function q(e){let t=Math.max(e.start,F.value)-F.value,n=Math.min(e.end,I.value)-F.value,r=t/60*B.value,i=Math.max((n-t)/60*B.value,6),a=100/e.groupCols,o=e.col*a;return{top:`${r}px`,height:`${i}px`,left:`${o}%`,width:`calc(${a}% - 6px)`}}async function He(e){D.value=e,await H(),L.value&&(L.value.scrollTop=0)}function J(e){e.classes.length===1&&e.count===1?(k.value=`Edit — ${e.classes[0].title}`,A.value=[e],j.value=`edit-single`,O.value=!0):(k.value=`${X(e.start,e.end)} — ${e.classes.length} classes`,A.value=[e],j.value=`list-single-timeslot`,O.value=!0)}function Y(e,t){let n=T.value[e]?.[t]||[];n.length&&(A.value=n.slice(),k.value=`${e} — ${X(Math.min(...n.map(e=>e.start)),Math.max(...n.map(e=>e.end)))}`,j.value=`multi-timeslot`,O.value=!0)}function X(e,t){return`${K(e)} - ${K(t)}`}function Z(e){N.value=e,M.value=!0}function Q(e){y.success(`Saved (simulate)${e.start_time} - ${e.end_time}`),M.value=!1,H()}function Ue(){O.value=!1,A.value=[]}function We(e){let t=e.target;R.value&&(R.value.scrollLeft=t.scrollLeft)}let Ge=m(()=>{let e=[];for(let t=F.value;t<I.value;t+=S)e.push(t);return e}),Ke=m(()=>(I.value-F.value)/60*B.value),qe=m(()=>100/x.length),Je=m(()=>{let e={};for(let t of x)e[t.key]={groups:T.value[t.key]||[],eventsFlat:w.value[t.key]||[]};return e});function $(){l(()=>{P.value.forEach(e=>{if(!e)return;let t=e.__vnode?.key;if(!t)return;let n=Object.values(w.value).flat().find(e=>String(e.id)===String(t));n&&(n._isCompact=e.offsetHeight<56||e.offsetWidth<100)})})}return g(async()=>{await H(),$()}),f(C,()=>{U(),W()}),f(w,()=>$(),{deep:!0}),(r,c)=>{let l=ue,f=de,m=le,g=se,y=ie,b=re,S=ae,C=ee,w=ne,T=te,D=oe,F=ce;return p(),n(t,null,[a(`div`,pe,[c[12]||=a(`h1`,{class:`text-2xl font-semibold tracking-wide`},` Class Scheduler `,-1),e(l,{type:`primary`,class:`!bg-blue-600 hover:!bg-blue-700 font-medium rounded-xl shadow-md`},{default:_(()=>[...c[11]||=[v(` + Add Schedule `,-1)]]),_:1})]),e(fe,{onFiltersChange:He}),E.value?(p(),n(`div`,me,[e(f,{size:`large`,tip:`Loading schedules...`})])):(p(),n(`div`,he,[a(`div`,ge,[c[13]||=a(`div`,{class:`header-left sticky-time-col`},null,-1),a(`div`,{ref_key:`headerDaysRef`,ref:R,class:`header-days`},[(p(),n(t,null,h(x,e=>a(`div`,{key:e.key,class:`day-cell`},[a(`div`,_e,u(e.label),1)])),64))],512)]),a(`div`,ve,[a(`div`,ye,[(p(!0),n(t,null,h(Ge.value,e=>(p(),n(`div`,{key:e,class:`time-slot`,style:d({height:`${V.value}px`})},[e%60==0?(p(),n(`div`,be,u(Ve(e)),1)):s(``,!0)],4))),128))]),a(`div`,{ref_key:`daysGridRef`,ref:L,class:`days-grid`,onScroll:We},[a(`div`,{class:`days-row`,style:d({height:`${Ke.value}px`})},[(p(),n(t,null,h(x,e=>a(`div`,{key:e.key,class:`day-column`,style:d({width:`${qe.value}%`})},[(p(!0),n(t,null,h(Ge.value,t=>(p(),n(`div`,{key:`bg-${e.key}-${t}`,class:`bg-slot`,style:d({height:`${V.value}px`})},null,4))),128)),a(`div`,xe,[(p(!0),n(t,null,h(Je.value[e.key].groups,(r,i)=>(p(),n(t,null,[r[0].classes.length<3?(p(!0),n(t,{key:0},h(r,e=>(p(),n(`div`,{key:e.id,ref_for:!0,ref:e=>P.value.push(e),class:`event`,style:d(q(e))},[e.count>1?(p(),o(m,{key:0,title:e.classes.map(e=>e.title).slice(0,5).join(`; `),placement:`top`},{default:_(()=>[a(`div`,{class:`event-card clickable`,onClick:t=>J(e)},[a(`div`,Ce,u(e.classes[0]?.title),1),a(`div`,we,u(e.classes.slice(0,2).map(e=>e.section).join(`, `)),1),e.count>1?(p(),n(`div`,Te,u(e.count-1)+` more `+u(e.count-1==1?`class`:`classes`),1)):s(``,!0)],8,Se)]),_:2},1032,[`title`])):(p(),n(`div`,{key:1,class:`event-card clickable`,onClick:t=>J(e)},[a(`div`,De,u(e.classes[0]?.title),1),a(`div`,Oe,u(e.classes.slice(0,2).map(e=>e.section).join(`, `)),1),e.count>1?(p(),n(`div`,ke,u(e.count-1)+` more `,1)):s(``,!0)],8,Ee))],4))),128)):(p(!0),n(t,{key:1},h(r.slice(0,2),t=>(p(),n(`div`,{key:t.id,ref_for:!0,ref:e=>P.value.push(e),class:`event`,style:d(q(t))},[t.count>1?(p(),o(m,{key:0,title:t.classes.map(e=>e.title).slice(0,5).join(`; `),placement:`top`},{default:_(()=>[a(`div`,{class:`event-card clickable`,onClick:t=>Y(e.key,i)},[a(`div`,je,u(t.classes[0]?.title),1),a(`div`,Me,u(t.classes.slice(0,2).map(e=>e.section).join(`, `)),1),t.count>1?(p(),n(`div`,Ne,u(t.count-1)+` more `,1)):s(``,!0)],8,Ae)]),_:2},1032,[`title`])):(p(),n(`div`,{key:1,class:`event-card clickable`,onClick:t=>Y(e.key,i)},[a(`div`,Fe,u(t.classes[0]?.title),1)],8,Pe))],4))),128))],64))),256)),(p(!0),n(t,null,h(Je.value[e.key].eventsFlat,e=>(p(),n(t,{key:`flat-${e.id}`},[],64))),128))])],4)),64))],4)],544)]),e(D,{open:O.value,"onUpdate:open":c[4]||=e=>O.value=e,title:k.value,placement:`right`,width:`480`,"mask-closable":!0,onClose:Ue},{default:_(()=>[j.value===`edit-single`&&A.value.length?(p(),n(`div`,Ie,[c[15]||=a(`h3`,null,`Edit Class`,-1),e(b,{layout:`vertical`},{default:_(()=>[e(y,{label:`Title`},{default:_(()=>[e(g,{value:A.value[0].classes[0].title,"onUpdate:value":c[0]||=e=>A.value[0].classes[0].title=e},null,8,[`value`])]),_:1}),e(y,{label:`Professor`},{default:_(()=>[e(g,{value:A.value[0].classes[0].professor,"onUpdate:value":c[1]||=e=>A.value[0].classes[0].professor=e},null,8,[`value`])]),_:1}),e(y,{label:`Room`},{default:_(()=>[e(g,{value:A.value[0].classes[0].room,"onUpdate:value":c[2]||=e=>A.value[0].classes[0].room=e},null,8,[`value`])]),_:1}),e(y,null,{default:_(()=>[e(l,{type:`primary`,onClick:c[3]||=()=>{Q(A.value[0].classes[0]),Ue()}},{default:_(()=>[...c[14]||=[v(` Save `,-1)]]),_:1})]),_:1})]),_:1})])):j.value===`list-single-timeslot`&&A.value.length?(p(),n(`div`,Le,[e(C,{"data-source":A.value[0].classes,pagination:!1,"row-key":`id`,size:`small`},{default:_(()=>[e(S,{title:`Title`,"data-index":`title`}),e(S,{title:`Section`,"custom-render":({record:e})=>e.section||`-`},null,8,[`custom-render`]),e(S,{title:`Professor`,"data-index":`professor`}),e(S,{title:`Room`,"data-index":`room`}),e(S,{title:`Actions`,"custom-render":({record:e})=>i(`a`,{onClick:()=>Z(e)},`Edit`)},null,8,[`custom-render`])]),_:1},8,[`data-source`])])):j.value===`multi-timeslot`&&A.value.length?(p(),n(`div`,Re,[e(T,{accordion:``},{default:_(()=>[(p(!0),n(t,null,h(Be.value,t=>(p(),o(w,{key:t.key,header:t.key},{default:_(()=>[e(C,{"data-source":t.classes,pagination:!1,"row-key":`id`,size:`small`},{default:_(()=>[e(S,{title:`Title`,"data-index":`title`}),e(S,{title:`Section`,"custom-render":({record:e})=>e.section||`-`},null,8,[`custom-render`]),e(S,{title:`Professor`,"data-index":`professor`}),e(S,{title:`Room`,"data-index":`room`}),e(S,{title:`Actions`,"custom-render":({record:e})=>i(`a`,{onClick:()=>Z(e)},`Edit`)},null,8,[`custom-render`])]),_:1},8,[`data-source`])]),_:2},1032,[`header`]))),128))]),_:1})])):s(``,!0)]),_:1},8,[`open`,`title`]),e(F,{visible:M.value,"onUpdate:visible":c[8]||=e=>M.value=e,title:`Edit Class`,onOk:c[9]||=()=>{N.value&&Q(N.value)},onCancel:c[10]||=()=>M.value=!1},{default:_(()=>[N.value?(p(),n(`div`,ze,[e(b,{layout:`vertical`},{default:_(()=>[e(y,{label:`Title`},{default:_(()=>[e(g,{value:N.value.title,"onUpdate:value":c[5]||=e=>N.value.title=e},null,8,[`value`])]),_:1}),e(y,{label:`Professor`},{default:_(()=>[e(g,{value:N.value.professor,"onUpdate:value":c[6]||=e=>N.value.professor=e},null,8,[`value`])]),_:1}),e(y,{label:`Room`},{default:_(()=>[e(g,{value:N.value.room,"onUpdate:value":c[7]||=e=>N.value.room=e},null,8,[`value`])]),_:1})]),_:1})])):s(``,!0)]),_:1},8,[`visible`])]))],64)}}}),[[`__scopeId`,`data-v-7d3bea38`]]);export{C as default};