import{B as e,N as t,Tt as n,_t as r,it as i,yt as a}from"./vue-UmFUivib.js";import{At as o,Jt as s,Nt as c,Pt as l,V as u,Y as d,fn as f,kt as p,nt as m}from"./antd-B_p1HNUS.js";import{g as h}from"./index-BwYHa19M.js";var g=`http://localhost:8000/api/schedules`;function _(){return{headers:{Authorization:`Bearer ${localStorage.getItem(`authToken`)||`6|npbSnXBNjKYCutBsf8JG2MwwJnnIU64RzhtFH2Eydffd3665`}`}}}async function v(e,t=null){try{let n={class_section_id:e.class_section_id,professor_id:e.professor_id,day_of_week:e.day_of_week,start_time:e.start_time,end_time:e.end_time,exclude_id:t,room_id:e.room_id};return(await h.post(`${g}/check-conflict`,n,_())).data}catch(e){return console.error(`Conflict check failed:`,e),{exists:!1}}}async function y(){try{return(await h.get(g,_())).data}catch(e){return console.error(`Fetching failed:`,e),{}}}async function b(e,t){try{return(await h.get(`${g}/timeslot/${e}/${t}`,_())).data}catch(e){return console.error(`Fetching failed:`,e),{}}}async function x(e){let t=await v(e);if(t.hasConflict)throw Object.assign(Error(t.message),{meta:{exists:!0,message:t.message}});return(await h.post(g,e,_())).data}async function S(e,t){let n=await v(t,e);if(n.hasConflict)throw Object.assign(Error(n.message),{meta:{exists:!0,message:n.message}});return(await h.put(`${g}/${e}`,t,_())).data}async function C(e){try{return(await h.delete(`${g}/${e}`,_())).data}catch(e){return console.error(`Delete failed:`,e),{exists:!1}}}var w={fetchSchedules:y,fetchTimeslotSchedules:b,createSchedule:x,updateSchedule:S,deleteSchedule:C,checkConflict:v},T={__name:`form`,props:{open:Boolean,isEditing:Boolean,record:Object,subjects:Array,professors:Array,rooms:Array,sections:Array},emits:[`close`,`saved`],setup(h,{emit:g}){let _=h,v=g,y=n(!1),b=n(null),x=n({day_of_week:``,subject_id:``,professor_id:``,start_time:null,end_time:null,room_id:``,class_section_id:``}),S={day_of_week:[{required:!0,message:`Please select a day`}],subject_id:[{required:!0,message:`Please select a subject`}],professor_id:[{required:!0,message:`Please select a professor`}],start_time:[{required:!0,message:`Please select start time`}],end_time:[{required:!0,message:`Please select end time`}],room_id:[{required:!0,message:`Please select a room`}],class_section_id:[{required:!0,message:`Please select a section`}]},C=[{label:`Monday`,value:`Monday`},{label:`Tuesday`,value:`Tuesday`},{label:`Wednesday`,value:`Wednesday`},{label:`Thursday`,value:`Thursday`},{label:`Friday`,value:`Friday`},{label:`Saturday`,value:`Saturday`},{label:`Sunday`,value:`Sunday`}];r(()=>_.record,e=>{e&&_.isEditing&&(x.value={day_of_week:e.day_of_week,subject_id:e.subject_id,professor_id:e.professor_id,start_time:s(e.start_time,`HH:mm`),end_time:s(e.end_time,`HH:mm`),room_id:e.room_id,class_section_id:e.class_section_id})},{immediate:!0});async function T(){try{await b.value.validate(),y.value=!0;let e={...x.value,semester:`1st Sem`,academic_year:`AY 2024-2025`,start_time:x.value.start_time.format(`HH:mm`),end_time:x.value.end_time.format(`HH:mm`)};if(_.isEditing)try{await w.updateSchedule(_.record.class_schedule_id,e),p.success(`Schedule updated successfully!`)}catch{p.error()}else await w.createSchedule(e),p.success(`Schedule added successfully!`);v(`saved`),E()}catch(e){e.meta?.exists?p.error(e.meta.message||`Conflict detected`):e.errorFields?p.warning(`Please fill out all required fields`):(p.error(`Something went wrong`),console.error(e))}finally{y.value=!1}}function E(){v(`close`),x.value={day_of_week:``,subject_id:``,professor_id:``,start_time:null,end_time:null,room_id:``,class_section_id:``}}return(n,r)=>{let s=f,p=l,g=u,_=o,v=d,w=c,D=m;return i(),t(D,{open:h.open,title:h.isEditing?`Edit Class Schedule`:`Add Class Schedule`,"confirm-loading":y.value,width:`600px`,"destroy-on-close":``,onCancel:E,onOk:T},{default:a(()=>[e(w,{ref_key:`formRef`,ref:b,model:x.value,rules:S,layout:`vertical`},{default:a(()=>[e(p,{label:`Day of the Week`,name:`day_of_week`},{default:a(()=>[e(s,{value:x.value.day_of_week,"onUpdate:value":r[0]||=e=>x.value.day_of_week=e,placeholder:`Select day`,options:C},null,8,[`value`])]),_:1}),e(p,{label:`Subject`,name:`subject_id`},{default:a(()=>[e(s,{value:x.value.subject_id,"onUpdate:value":r[1]||=e=>x.value.subject_id=e,placeholder:`Select subject`,options:h.subjects.map(e=>({label:`${e.subject_code} - ${e.subject_name}`,value:e.subject_id}))},null,8,[`value`,`options`])]),_:1}),e(p,{label:`Professor`,name:`professor_id`},{default:a(()=>[e(s,{value:x.value.professor_id,"onUpdate:value":r[2]||=e=>x.value.professor_id=e,placeholder:`Select professor`,options:h.professors.map(e=>({label:`${e.first_name} ${e.last_name}`,value:e.professor_id}))},null,8,[`value`,`options`])]),_:1}),e(v,{gutter:16},{default:a(()=>[e(_,{span:12},{default:a(()=>[e(p,{label:`Start Time`,name:`start_time`},{default:a(()=>[e(g,{value:x.value.start_time,"onUpdate:value":r[3]||=e=>x.value.start_time=e,format:`HH:mm`,style:{width:`100%`},placeholder:`Start`},null,8,[`value`])]),_:1})]),_:1}),e(_,{span:12},{default:a(()=>[e(p,{label:`End Time`,name:`end_time`},{default:a(()=>[e(g,{value:x.value.end_time,"onUpdate:value":r[4]||=e=>x.value.end_time=e,format:`HH:mm`,style:{width:`100%`},placeholder:`End`},null,8,[`value`])]),_:1})]),_:1})]),_:1}),e(p,{label:`Room`,name:`room_id`},{default:a(()=>[e(s,{value:x.value.room_id,"onUpdate:value":r[5]||=e=>x.value.room_id=e,placeholder:`Select room`,options:h.rooms.map(e=>({label:`${e.building_name} - room: ${e.room_number}`,value:e.room_id}))},null,8,[`value`,`options`])]),_:1}),e(p,{label:`Section`,name:`class_section_id`},{default:a(()=>[e(s,{value:x.value.class_section_id,"onUpdate:value":r[6]||=e=>x.value.class_section_id=e,placeholder:`Select section`,options:h.sections.map(e=>({label:e.section_name,value:e.class_section_id}))},null,8,[`value`,`options`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`open`,`title`,`confirm-loading`])}}};export{w as n,T as t};